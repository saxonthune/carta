# Look and Feel Guidelines

## Visual Hierarchy & Depth System

### Three-Level Depth System

Carta uses a three-level depth system to create visual hierarchy and improve readability in multi-panel layouts. This system creates a sense of depth that guides the user's focus.

#### Depth Levels

**Level 1 - Lightest (Outermost)**
- **Usage**: Left tab bars, outermost navigation panels
- **CSS Variable**: `--color-surface-depth-1`
- **Tailwind Class**: `bg-surface-depth-1`
- **Purpose**: Acts as the entry point for navigation, drawing attention to primary navigation controls

**Level 2 - Medium (Middle)**
- **Usage**: Island containers within sidebars (e.g., construct lists, deployable lists, grouped sections)
- **CSS Variable**: `--color-surface-depth-2`
- **Tailwind Class**: `bg-surface-depth-2`
- **Purpose**: Contains grouped content that sits between navigation and main content, creating clear visual boundaries

**Level 3 - Deepest (Innermost)**
- **Usage**: Main content areas, editor panels, primary work surfaces
- **CSS Variable**: `--color-surface-depth-3`
- **Tailwind Class**: `bg-surface-depth-3`
- **Purpose**: Represents the deepest level where primary work happens, focusing user attention on content

#### Theme-Specific Behavior

**Dark Themes (dark, warm)**
- Level 1 is **lightest**
- Level 2 is **medium**
- Level 3 is **darkest**
- Creates a "looking into a hole" effect - depth increases as you go inward

**Light Themes (light)**
- Level 1 is **slightly lighter than surface**
- Level 2 is **medium gray**
- Level 3 is **white/lightest**
- Creates a "hill" effect - content area is elevated and brightest

### Color Values by Theme

```css
/* Light Theme */
--color-surface-depth-1: #f9fafb;  /* Lightest */
--color-surface-depth-2: #f3f4f6;  /* Medium */
--color-surface-depth-3: #ffffff;  /* Brightest (inverted) */

/* Dark Theme */
--color-surface-depth-1: #1e293b;  /* Lightest */
--color-surface-depth-2: #172033;  /* Medium */
--color-surface-depth-3: #0f172a;  /* Darkest */

/* Warm Theme */
--color-surface-depth-1: #2c2218;  /* Lightest */
--color-surface-depth-2: #221814;  /* Medium */
--color-surface-depth-3: #1c1410;  /* Darkest */
```

## Layout Structure

### Typical Three-Column Layout

```
┌─────────────────────────────────────────────┐
│  Header (surface-elevated)                  │
├──────┬──────────────────┬───────────────────┤
│ Tabs │  Sidebar         │  Main Content     │
│ (L1) │  with Islands    │  (L3)             │
│      │  (L1 bg)         │                   │
│      │  ┌────────────┐  │                   │
│      │  │ Island (L2)│  │                   │
│      │  │  - Item 1  │  │                   │
│      │  │  - Item 2  │  │                   │
│      │  └────────────┘  │                   │
│      │  ┌────────────┐  │                   │
│      │  │ Island (L2)│  │                   │
│      │  │  - Item 3  │  │                   │
│      │  └────────────┘  │                   │
└──────┴──────────────────┴───────────────────┘
```

### Component Examples

**Drawer.tsx**:
- Floating tabs: Use accent highlighting for active tab (`bg-accent/30`, `ring-2 ring-accent/60`)
- Drawer panel: `bg-surface-depth-1` for main panel background
- Content area: Each tab's content uses appropriate depth levels

**ConstructEditor.tsx**:
- Level 1: Left sidebar (`bg-surface-depth-1`)
- Level 2: Built-in/Custom islands (`bg-surface-depth-2`)
- Level 3: Main editor area (`bg-surface-depth-3`)

**DeployablesEditor.tsx**:
- Level 1: Left sidebar (`bg-surface-depth-1`)
- Level 2: Deployables island (`bg-surface-depth-2`)
- Level 3: Edit form area (`bg-surface-depth-3`)

## Draggable Windows

Draggable windows are floating UI elements for displaying detailed information without blocking the canvas.

### Pattern

- **No backdrop**: Window floats over canvas without darkening (no `bg-black/50` overlay)
- **Draggable header**: Click and drag depth-2 header to reposition
- **Pin control**: Pin button keeps window open when clicking outside (unpinned = auto-close)
- **Island UX**: Uses depth-3 ground with depth-2 islands for content sections
- **Pointer events**: Window shell is `pointer-events-none` on parent, `pointer-events-auto` on actual window

### Structure

```tsx
<div className="fixed inset-0 z-[1001] pointer-events-none">
  <div className="absolute bg-surface-depth-1 rounded-xl pointer-events-auto">
    {/* Header - Island (depth-2), draggable */}
    <div className="bg-surface-depth-2 px-5 py-4 rounded-t-xl cursor-grab">
      <h2>{title}</h2>
      <PinIcon filled={isPinned} />
      <CloseIcon />
    </div>

    {/* Content - Ground layer (depth-3) */}
    <div className="bg-surface-depth-3 p-4 rounded-b-xl">
      {/* Islands for content sections (depth-2) */}
      <section className="bg-surface-depth-2 rounded-xl p-4">
        {/* Display well (inset) */}
        <div className="bg-surface-inset rounded-lg p-3">
          {content}
        </div>
      </section>
    </div>
  </div>
</div>
```

### Use Cases

- **Full view window**: Comprehensive node information (ConstructFullViewModal)
- **Comparison mode**: View details while working on canvas
- **Inspector panels**: Draggable property inspectors

### Key Behaviors

1. **Click outside unpinned**: Window closes automatically
2. **Click outside pinned**: Window stays open, allows canvas interaction
3. **Dragging**: Only from header (depth-2 area), content scrolls independently
4. **Escape key**: Closes unpinned windows only

## Text Legibility

### Universal Text Halo

For text that must be readable on any background color (especially colored node headers), use the `text-halo` utility class:

```css
@utility text-halo {
  text-shadow:
    0 2px 12px rgba(0, 0, 0, 0.8),
    0 4px 24px rgba(0, 0, 0, 0.6),
    0 8px 48px rgba(0, 0, 0, 0.4);
}
```

**Usage**: Apply to white text on colored backgrounds where contrast may vary.

**Pattern**: Layered soft blur approach creates readable text without requiring dynamic color contrast switching.

**Examples**:
- Node headers (`ConstructNode.tsx`) at all LOD levels (pill/compact/normal)
- Any text overlaid on user-customizable background colors

## Design Principles

### Clarity Over Decoration
- Use depth and spacing to create hierarchy, not heavy borders
- Let backgrounds do the work of visual separation

### Consistency
- Always use the three-level depth system for multi-panel layouts
- Apply island pattern consistently for grouped content
- Use the same selection highlight pattern throughout the app

### Responsiveness
- Adjust padding and spacing based on fullscreen vs. dock mode
- Maintain visual hierarchy regardless of size

### Accessibility
- Ensure sufficient contrast between depth levels (test with color contrast tools)
- Selection highlighting must be clearly visible in all themes
- Hover states should provide clear feedback

## Implementation Checklist

When creating a new multi-panel component:

- [ ] Use `bg-surface-depth-1` for the outermost navigation/tab container
- [ ] Use `bg-surface-depth-2` for island containers with `rounded-xl`
- [ ] Use `bg-surface-depth-3` for the main content area
- [ ] Remove borders in favor of depth-based separation
- [ ] Apply standard selection highlighting to interactive items
- [ ] Test in all themes (light, dark, warm) to ensure proper contrast
- [ ] Verify hover states provide clear feedback
- [ ] Ensure responsive sizing for fullscreen vs. dock modes
